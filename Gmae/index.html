<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°”ì´ë¯¼ ë§ˆë¸” ì»¨íŠ¸ë¡¤ëŸ¬</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { text-align: center; font-family: sans-serif; background: #f4f4f4; padding: 20px; margin: 0; }
        .char-btn { font-size: 35px; margin: 5px; padding: 10px; border: 2px solid #ddd; background: white; border-radius: 12px; cursor: pointer; width: 65px; }
        .char-btn.disabled { opacity: 0.1; cursor: not-allowed; }
        .char-btn.selected { border-color: #ff4757; background: #ffeae6; }
        #play { display: none; }
        .dice-btn { width: 160px; height: 160px; font-size: 50px; border-radius: 50%; border: none; background: #ff4757; color: white; box-shadow: 0 8px #d63031; cursor: pointer; margin-top: 20px; }
        .dice-btn:active { box-shadow: 0 2px #d63031; transform: translateY(4px); }
    </style>
</head>
<body>
    <div id="login">
        <h2>ğŸ· ìºë¦­í„° ì„ íƒ ğŸ·</h2>
        <input id="nameInput" type="text" placeholder="ì´ë¦„ ì…ë ¥ (4ì)" maxlength="4" style="padding:15px; width:80%; font-size:18px; border-radius:10px; border:1px solid #ccc; margin-bottom:15px;"><br>
        <div id="charList">
            <button class="char-btn" onclick="selectChar(this, 'ğŸº')">ğŸº</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ¶')">ğŸ¶</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ·')">ğŸ·</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ¹')">ğŸ¹</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ”¥')">ğŸ”¥</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ¤¢')">ğŸ¤¢</button>
            <button class="char-btn" onclick="selectChar(this, 'ğŸ˜')">ğŸ˜</button>
        </div>
        <button onclick="join()" style="margin-top:25px; padding:15px 40px; font-size:20px; background: #2d3436; color:white; border:none; border-radius:10px; font-weight:bold;">ê²Œì„ ì…ì¥</button>
    </div>

    <div id="play">
        <h2 id="myInfo"></h2>
        <button class="dice-btn" onclick="roll()">ğŸ²</button>
        <h1 id="diceNum">?</h1>
        <div id="penaltyBox" style="min-height:100px; background:white; border-radius:15px; display:flex; align-items:center; justify-content:center; padding:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1);">
            <p id="penaltyMsg" style="font-size:22px; font-weight:bold; color:#ff4757; margin:0;"></p>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://jurumable-9fdde-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let selectedChar = "", myId = "", currentPos = 0;

        // ë¯¸ë‹ˆê²Œì„ URL ì£¼ì†Œ (ê°™ì€ í´ë”ì— ìˆë‹¤ë©´ íŒŒì¼ëª…ë§Œ ì ìœ¼ì„¸ìš”)
        const minigameUrl = "game.html"; 

        const penalties = [ "ì‹œì‘!", "í•œì” ë§ˆì…”", "ì˜†ì‚¬ëŒ ë§ˆì…”", "ğŸ—ï¸í™©ê¸ˆì—´ì‡ ", "ğŸ®ëœë¤ê²Œì„", "íŒ¨ìŠ¤~", "ì±Œë¦°ì§€ ë…¸ë˜ì¶”ê¸°", "21í•™ë²ˆ ë§ˆì…”",
            "ë‘ì” ë§ˆì…”", "ëª¨ë‘ ë§ˆì…”", "í•œ í„´ í• ë¨¸ë‹ˆ", "ğŸ—ï¸í™©ê¸ˆì—´ì‡ ", "ë’¤ë¡œ í•œì¹¸", "ëˆ„êµ¬ ë§ˆì…”", "ì˜†ì‚¬ëŒ ë§ˆì…”", "ë‚˜ë§Œ ë¹¼ê³  ë§ˆì…”",
            "ë„ˆë§Œ ë¹¼ê³  ë§ˆì…”", "23í•™ë²ˆ ë§ˆì…”", "ğŸ—ï¸í™©ê¸ˆì—´ì‡ ", "ğŸ®ëœë¤ê²Œì„", "íŒ¨ìŠ¤~", "ë²Œì£¼ ë§ˆì…”~", "í•œ í„´ ê³ ì–‘ì´", "ê°™ì´ ë§ˆì…”~",
            "ëª¨ë‘ ë§ˆì…”", "ğŸ—ï¸í™©ê¸ˆì—´ì‡ ", "í•œ ì” ë§ˆì…”", "ë„ì°©ê¸°ë… ë§ˆì…”~"];
        const goldKeys = ["ë‚˜ ì•ˆë§ˆì…”!", "ë‚˜ ëŒ€ì‹  ë§ˆì…”", "ë‹¤ìŒ íŒ ì£¼ì‚¬ìœ„ +2", "ì§€ê¸ˆ ë‹¹ì¥ ë‚˜ë§Œ ë§ˆì…”", "ì „ì› ë§ˆì‹œê¸°", "ê²Œì„ ë©´ì œê¶Œ", "ë©´ì œê¶Œ", "ëª¨ë‘ ë‚˜ì—ê²Œ ì¡´ëŒ“ë§"];

        db.ref('players').on('value', (snap) => {
            const players = snap.val();
            document.querySelectorAll('.char-btn').forEach(btn => {
                btn.classList.remove('disabled'); btn.disabled = false;
                for(let key in players) { if(players[key].char === btn.innerText && key !== myId) { btn.classList.add('disabled'); btn.disabled = true; } }
            });
            if(!players && myId !== "") location.reload(); 
        });

        function selectChar(btn, char) {
            if(btn.disabled) return;
            document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected'); selectedChar = char;
        }

        function join() {
            const name = document.getElementById('nameInput').value;
            if(!name || !selectedChar) return alert("ì´ë¦„ê³¼ ìºë¦­í„°ë¥¼ ê³¨ë¼ì¤˜!");
            myId = Date.now() + "_" + name;
            db.ref('players/' + myId).set({ name, char: selectedChar, pos: 0, time: Date.now() });
            document.getElementById('login').style.display = 'none';
            document.getElementById('play').style.display = 'block';
            document.getElementById('myInfo').innerText = `${selectedChar} ${name}ë‹˜`;
        }

        function roll() {
            const dice = Math.floor(Math.random() * 6) + 1;
            currentPos = (currentPos + dice) % 28;
            db.ref('players/' + myId).update({ pos: currentPos });
            document.getElementById('diceNum').innerText = dice;
            
            const currentPenalty = penalties[currentPos];

            // ëœë¤ê²Œì„ ì´ë™ ë¡œì§
            if (currentPenalty.includes("ëœë¤ê²Œì„")) {
                alert("ğŸ® ëœë¤ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!");
                window.location.href = minigameUrl;
                return;
            }

            // í™©ê¸ˆì—´ì‡  ë¡œì§
            if (currentPenalty.includes("ğŸ—ï¸")) {
                const key = goldKeys[Math.floor(Math.random() * goldKeys.length)];
                document.getElementById('penaltyMsg').innerHTML = `<span style="color:gold; text-shadow:1px 1px 1px #000;">âœ¨í™©ê¸ˆì—´ì‡ âœ¨</span><br>${key}`;
                if(navigator.vibrate) navigator.vibrate([100, 30, 100]);
            } else {
                document.getElementById('penaltyMsg').innerText = currentPenalty;
            }
        }
    </script>
</body>
</html>